# 2.2 Estructura Global de un Documento Web

## Introducción: Anatomía de una Página

Un documento HTML5 no es un archivo de texto cualquiera. Tiene una estructura jerárquica estricta (Árbol) que el navegador espera.
Si violas esta estructura, el navegador entrará en **modo de recuperación de errores**, lo cual es lento e impredecible.

### Estructura Básica
Todo documento HTML5 debe tener esto. Si te falta algo, la página puede verse rara o fallar en Google.

```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"> <!-- Para que se vean las ñ y acentos -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Para celulares -->
    <title>Mi Página</title>
</head>
<body>
    <h1>Hola Mundo</h1>
</body>
</html>
```

---

## El DOCTYPE: La Declaración de Identidad

### ¿Qué es `<!DOCTYPE html>`?
No es una etiqueta HTML. Es una instrucción que le grita al navegador: **"¡Hey! Estoy usando HTML5 moderno"**.
*   **Regla:** Debe ser la primerísima línea.
*   **Riesgo:** Si lo quitas, el navegador entra en "Modo Antiguo" (Quirks Mode) y tu diseño se romperá.

---

## El Elemento Raíz: `<html>`

Todo lo demás vive dentro de aquí. Es el nodo raíz del árbol DOM.

### El atributo `lang`
`<html lang="es">`
Esto es **crítico** por dos razones:
1.  **Accesibilidad:** Le dice al lector de pantalla con qué acento pronunciar el texto. Si tienes texto en español pero `lang="en"`, sonará como un gringo tratando de hablar español.
2.  **Traducción:** Le dice a Google Chrome si debe sacar el popup de "¿Quieres traducir esta página?".

### `dir` (Direction)
Para idiomas que se leen de derecha a izquierda (Árabe, Hebreo).
`<html dir="rtl">` (Right To Left).

---

## El Cerebro: `<head>`

El `<head>` contiene metadatos: información *sobre* la página que no se ve directamente en la ventana.

### Metadatos Críticos (El cerebro de la página)
1.  **`<meta charset="UTF-8">`:** Permite usar Ñ, acentos y emojis. Sin esto, verás símbolos raros.
2.  **`<meta name="viewport" ...>`:** Obligatorio para que la web se vea bien en celulares. Sin esto, el móvil simula ser una pantalla de escritorio y todo se ve minúsculo.
3.  **`<title>`:** Lo que sale en la pestaña del navegador y en Google. Importante para SEO.

---

## Vinculando Recursos: `<link>`

La etiqueta `<link>` es la autopista para traer recursos externos. Es vacía (no tiene cierre).

### CSS (Stylesheets)
`<link rel="stylesheet" href="style.css">`
*   El navegador **bloquea el renderizado** hasta descargar y leer este archivo.
*   *Optimización:* Pon solo el CSS crítico aquí.

### Favicons
El icono de la pestaña. Hoy en día es un caos.
```html
<!-- Básico -->
<link rel="icon" href="favicon.ico" sizes="any">
<link rel="icon" href="icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="icon.png"> <!-- iOS Homescreen -->
<link rel="manifest" href="site.webmanifest"> <!-- Android PWA -->
```

### Preload y Prefetch (Performance)
Técnicas avanzadas para acelerar la carga.
*   `rel="preload"`: "Descarga esto YA, lo voy a usar en 1 segundo". (Ej. Fuentes, Hero Image).
*   `rel="prefetch"`: "Descarga esto si te sobra tiempo, el usuario podría ir a esa página después".

---

## Scripts: `<script>`

Aquí vive JavaScript.

### El Peligro del Bloqueo
Si pones `<script src="app.js">` en el `<head>`, el usuario verá una pantalla blanca hasta que se descargue el JS.
**Solución Clásica:** Poner los scripts justo antes de cerrar el `</body>`.

### Moderno: `async` vs `defer`
Hoy ponemos los scripts en el `<head>` pero con atributos especiales.
*   `<script src="app.js" async>`: Descarga en paralelo, ejecuta tan pronto termina. (El orden no se respeta). Bueno para Analytics.
*   `<script src="app.js" defer>`: Descarga en paralelo, ejecuta **después** de que el HTML termine de parsear. (Respeta el orden). **Esta es la mejor opción por defecto.**

---

### Redes Sociales (Open Graph)
Para que tu link se vea bonito en WhatsApp o Facebook (con foto y título).
```html
<meta property="og:title" content="Mi Web Increíble">
<meta property="og:image" content="https://miweb.com/foto.jpg">
```

---

## Atributos Globales: Las Herramientas Universales

Estos atributos funcionan en **cualquier** etiqueta HTML (`<div>`, `<span>`, `<body>`, `<p>`).

### Identidad y CSS
*   **`id`:** Identificador único.
    *   *Regla:* Solo puede haber UN elemento con `id="header"` en toda la página.
    *   *Uso:* Enlaces ancla (`<a href="#header">`), JS (`getElementById`), CSS (Alta especificidad).
*   **`class`:** Clasificador grupal.
    *   *Uso:* Estilar múltiples elementos igual. `class="btn btn-primary"`.
*   **`style`:** Estilos en línea.
    *   *Consejo:* Evítalo. Ensucia el HTML. Úsalo solo para valores dinámicos calculados por JS (ej. coordinadas de un drag-and-drop).

### Interacción y Estado
*   **`hidden`:** `<div hidden>` es el equivalente nativo a `display: none`.
    *   *Diferencia con CSS:* Si el CSS falla en cargar, `hidden` sigue ocultando el elemento.
*   **`tabindex`:** Controla el orden de tabulación del teclado.
    *   `0`: El elemento es focuseable (orden natural).
    *   `-1`: Focuseable via JS, pero no por teclado.
    *   `1+`: (Mala práctica) Fuerza un orden específico.
*   **`contenteditable`:** Convierte cualquier elemento en un editor de texto.
    *   `<p contenteditable="true">Edítame</p>`.

### `title` (Tooltip Nativo)
Muestra un texto pequeñito al pasar el mouse.
*   *Accesibilidad:* No confíes en él. Los usuarios móviles no tienen mouse, así que nunca lo ven.

---

### Seguridad (CSP)
Evita que hackers inyecten virus en tu página (XSS).
Es una lista blanca de "sitios confiables".
```html
<!-- Solo carga scripts de mi propio dominio -->
<meta http-equiv="Content-Security-Policy" content="script-src 'self'">
```

---

## Performance Avanzado: Resource Hints

Ya vimos `preload`, pero hay más.

### `dns-prefetch`
"Voy a conectarme a Google Fonts pronto, ve resolviendo la IP".
`<link rel="dns-prefetch" href="//fonts.googleapis.com">`
*   Ahorra: 20-100ms de búsqueda DNS.

### `preconnect`
"Voy a conectarme a este servidor seguro, haz el Handshake SSL ya".
`<link rel="preconnect" href="https://cdn.example.com" crossorigin>`
*   Ahorra: DNS + TCP + SSL Handshake. Es costoso, úsalo solo para dominios críticos.

### `prerender` (Nuclear)
"Renderiza esta página entera en una pestaña invisible".
`<link rel="prerender" href="siguiente-pagina.html">`
*   *Efecto:* Carga instantánea al hacer clic.
*   *Costo:* Consume mucha RAM y datos. Úsalo solo si estás 99% seguro de que el usuario irá ahí.

---

## El Mundo Caótico de los Favicons

En 2010 bastaba con `favicon.ico`. En 2025 necesitas esto:

| Archivo | Dimensión | Uso |
| :--- | :--- | :--- |
| **favicon.ico** | 16x16, 32x32 | Navegadores antiguos y escritorio. |
| **icon-192.png** | 192x192 | Android Homescreen (PWA). |
| **icon-512.png** | 512x512 | Android Splash Screen. |
| **apple-touch-icon.png** | 180x180 | iPhone/iPad Homescreen (Sin brillo). |
| **mstile-150x150.png** | 150x150 | Windows Tiles. |
| **safari-pinned-tab.svg** | SVG (Monocromo) | Pestañas fijadas en Safari Mac. |

**Consejo de Experto:** No lo hagas a mano. Usa un generador como `RealFaviconGenerator.net`.

---

## Laboratorio de Código: El Head Perfecto

Copia y pega este snippet en todos tus proyectos profesionales.

```html
<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
    <!-- 1. Configuración Básica -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi App Pro</title>

    <!-- 2. Seguridad -->
    <!-- Evita que el usuario haga zoom (Opcional, a veces malo para accesibilidad) -->
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> -->
    <!-- CSP Básico -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://trusted.cdn.com;">

    <!-- 3. SEO Básico -->
    <meta name="description" content="La mejor app para aprender programación web desde cero.">
    <meta name="author" content="Juan Pérez">
    <meta name="keywords" content="html, css, js, curso">
    <!-- Canonical: Evita contenido duplicado en Google -->
    <link rel="canonical" href="https://miapp.com/curso">

    <!-- 4. Open Graph (Redes Sociales) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://miapp.com">
    <meta property="og:title" content="Aprende Web Dev">
    <meta property="og:description" content="Curso intensivo de HTML5.">
    <meta property="og:image" content="https://miapp.com/og-image.jpg">

    <!-- 5. Favicons -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <!-- 6. Estilos Críticos -->
    <link rel="stylesheet" href="style.css">
    
    <!-- 7. Scripts (Diferidos) -->
    <script src="app.js" defer></script>
</head>
<body>
    <h1>¡Hola Mundo!</h1>
</body>
</html>
```

---

## Glosario de Estructura

*   **Block Element:** Elemento que ocupa todo el ancho disponible y empieza en nueva línea (`div`, `p`, `section`).
*   **Compatibilidad (Polyfill):** Usar JS para dar soporte a funciones nuevas en navegadores viejos.
*   **Inline Element:** Elemento que solo ocupa lo necesario y fluye con el texto (`span`, `a`, `strong`).
*   **Metadata:** Datos sobre los datos.
*   **MIME Type:** Identificador del formato de un archivo (`text/html`, `image/png`).
*   **Semantic Element:** Elemento que describe su significado (`<article>` vs `<div>`).
*   **Tag Soup:** HTML mal escrito, sin cerrar etiquetas, mezcla de mayúsculas y minúsculas (típico de los 90s).
*   **User Agent:** El software que lee la web (Chrome, Firefox, GoogleBot).
*   **Viewport:** El área visible de la página web.

---

## Ejercicios y Retos

### Reto 1: "Auditoría de Head"
Abre `mercadolibre.com.mx` (o el de tu país), inspecciona el `<head>`:
1.  Cuenta cuántas etiquetas `<meta>` tienen.
2.  ¿Usan `dns-prefetch`? ¿Para qué dominios?
3.  ¿Tienen etiqueta `canonical`?

### Reto 2: "El Favicon Perdido"
Crea un HTML simple.
Abre las herramientas de desarrollador (Network tab).
Recarga la página.
¿Ves una petición 404 roja buscando `favicon.ico`?
*   **Misión:** Haz que desaparezca creando un archivo de 16x16 píxeles (píntalo con Paint) y vinculándolo.

### Reto 3: "Hacking Ético con CSP"
Crea un HTML con esta CSP:
`<meta http-equiv="Content-Security-Policy" content="script-src 'self'">`
Intenta agregar un script:
`<script>alert("Soy un hacker")</script>`
¿Qué dice la consola del navegador?

---

## SEO Semántico: JSON-LD y Schema.org

Google ya no lee solo tu texto. Lee tus **datos estructurados**.
Esto se pone en el `<head>` dentro de un script especial.

### Ejemplo: Receta de Cocina
Sin esto, Google ve texto. Con esto, Google muestra la foto de la pizza y las calorías en los resultados de búsqueda.

```html
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "Recipe",
  "name": "Pizza Napolitana",
  "author": {
    "@type": "Person",
    "name": "Mario"
  },
  "datePublished": "2024-03-10",
  "description": "La mejor pizza del mundo.",
  "prepTime": "PT20M"
}
</script>
```

### Validacion
Usa el "Rich Results Test" de Google. Si tu JSON-LD está mal (una coma faltante), Google lo ignorará.

---

## Internacionalización (i18n): `hreflang`

Si tu sitio está en Español, Inglés y Francés, debes decírselo a Google para evitar problemas de "Contenido Duplicado".

```html
<link rel="alternate" hreflang="es" href="https://miweb.com/es/" />
<link rel="alternate" hreflang="en" href="https://miweb.com/en/" />
<link rel="alternate" hreflang="fr" href="https://miweb.com/fr/" />
<link rel="alternate" hreflang="x-default" href="https://miweb.com/" />
```
*   `x-default`: La versión para usuarios que no hablan ninguno de los idiomas (ej. un chino visitando tu web).

---

## Viewport Móvil Avanzado: El Notch

Los iPhone X trajeron el "Notch" (la ceja). Apple inventó extensiones al viewport para manejarlo.

### `viewport-fit=cover`
```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
```
*   Le dice al navegador: "Usa toda la pantalla, incluso el área debajo de la cámara".

### Variables de Entorno CSS
Para no poner texto debajo de la cámara (donde no se ve), usamos variables seguras:
```css
body {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
}
```

---

## PWA Manifest: El Puente a Nativo

El archivo `site.webmanifest` es un JSON que controla cómo se ve tu app cuando se instala en Android.

```json
{
    "name": "Mi Super App",
    "short_name": "SuperApp",
    "start_url": "/?source=pwa",
    "background_color": "#ffffff",
    "theme_color": "#4a90e2",
    "display": "standalone",
    "icons": [
        {
            "src": "icon-192.png",
            "sizes": "192x192",
            "type": "image/png"
        }
    ]
}
```
*   `display: standalone`: Elimina la barra de URL del navegador. ¡Parece una app nativa!
*   `theme_color`: Pinta la barra de estado de Android de azul.

---

## Seguridad de Subrecursos (SRI)

Si usas Bootstrap desde un CDN (`cdn.jsdelivr.net`), ¿qué pasa si hackean el CDN y cambian el archivo `bootstrap.js` por un virus?
Tu sitio ejecutaría el virus.

**Solución: Subresource Integrity (SRI)**
```html
<script src="https://example.com/example-framework.js"
        integrity="sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC"
        crossorigin="anonymous"></script>
```
*   El navegador descarga el archivo, calcula su Hash (SHA384).
*   Si el Hash NO coincide con el que tú pusiste (el atributo `integrity`), **bloquea la ejecución**.
*   *Nota:* Siempre usa SRI para CDNs públicos.

---

## La Etiqueta Peligrosa: `<base>`

Define la URL base para todos los enlaces relativos.

```html
<head>
    <base href="https://www.w3schools.com/images/" target="_blank">
</head>
<body>
    <img src="stickman.gif">
    <a href="html5.asp">HTML5 Tutorial</a>
</body>
```
*   La imagen cargará desde: `https://www.w3schools.com/images/stickman.gif`
*   El enlace irá a: `https://www.w3schools.com/images/html5.asp` (¡Cuidado! A veces rompe la navegación).
*   **Consejo:** Casi nunca la uses en proyectos modernos (SPAs), confunde al Router.

---

---

## Laboratorio de Código: Depuración de Sensores

El `<head>` controla cómo la web accede a los sensores del móvil.
1.  Abre Chrome DevTools (F12).
2.  Presiona `Ctrl+Shift+P` (Command+Shift+P en Mac).
3.  Escribe "Sensors".
4.  Juega con:
    *   **Location:** Simula estar en Tokio o Londres.
    *   **Orientation:** Simula girar el celular (Giroscopio).
    *   **Touch:** Simula dedos.

*Por qué importa:* Si tu `<meta name="viewport">` está mal, este simulador te mostrará una web rota.

---

## Metadatos Específicos de Apple (iOS)

Safari es el nuevo Internet Explorer. Requiere etiquetas especiales.

### Modo Pantalla Completa
Para que tu web se vea como una app nativa en iOS.
```html
<meta name="apple-mobile-web-app-capable" content="yes">
```

### Barra de Estado
¿Quieres que la barra de la hora/batería sea negra o transparente?
```html
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
```

### Título en Homescreen
```html
<meta name="apple-mobile-web-app-title" content="Mi App">
```

---

## La Red de Seguridad: `<noscript>`

Hay gente que navega sin JavaScript (Tor Browser, Paranoicos de seguridad, Crawlers viejos).
Si no pones esto, verán una página en blanco.

```html
<noscript>
    <div style="background: red; color: white; padding: 20px; text-align: center;">
        ⚠️ Esta aplicación requiere JavaScript para funcionar. Por favor actívalo.
    </div>
</noscript>
```
*   **Truco SEO:** Google lee lo que hay dentro de `<noscript>`. Puedes poner contenido clave ahí (pero no hagas spam, o te penalizan).

---

## Referencias y Estándares

*   **MDN - The Head Metadata in HTML:** Guía definitiva de Mozilla.
*   **Google Search Central - Meta Tags:** Qué etiquetas lee Google y cuáles ignora (ej. `keywords` ya no sirve).
*   **OWASP - Content Security Policy Cheat Sheet:** La biblia de la seguridad frontend.
*   **Open Graph Protocol:** Documentación oficial de Facebook.

---

---

## Content Security Policy (CSP) en Profundidad

La etiqueta `<meta>` más importante para la seguridad.
Define desde dónde se pueden cargar recursos.

### Bloqueando ataques XSS
```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' https://apis.google.com; img-src 'self' data:;">
```
*   `default-src 'self'`: Solo carga cosas de mi propio dominio.
*   `script-src ...`: Permite scripts locales y de Google. Bloquea todo lo demás.
*   **Resultado:** Si un hacker inyecta `<script src="hacker.com/evil.js">`, el navegador lo bloquea y lanza un error en consola.

---

## Subresource Integrity (SRI)

¿Qué pasa si usas Bootstrap desde un CDN (`cdn.jsdelivr.net`) y alguien hackea el CDN?
Podrían inyectar código malicioso en tu sitio.
SRI te protege.

```html
<link rel="stylesheet" 
      href="https://cdn.example.com/style.css"
      integrity="sha384-+/M6kredJcxd..."
      crossorigin="anonymous">
```
*   **Integrity:** Es un hash (huella digital) del archivo original.
*   **Cómo funciona:** El navegador descarga el archivo, calcula su hash, y si NO coincide con el que pusiste en `integrity` (porque fue modificado), **se niega a ejecutarlo**.

---

## La Guía Definitiva de Favicons (2025)

Dejamos de usar `favicon.ico` hace años. Hoy necesitas estos 4 archivos para cubrir el 99% de dispositivos:

1.  **`favicon.ico` (32x32):** Para navegadores legacy.
2.  **`favicon.svg`:** El futuro. Vectorial, escala infinito, soporta modo oscuro (CSS dentro del SVG).
3.  **`apple-touch-icon.png` (180x180):** Para cuando guardan tu web en el iPhone.
4.  **`manifest.json` (192 y 512):** Para Android y PWA.

**Código Moderno:**
```html
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">
```

---

---

## Debugging: ¿Por qué mi `<head>` está vacío?

Un error común: abres el inspector y ves que el `<body>` está vacío o el `<head>` tiene cosas raras.

### El Problema del BOM (Byte Order Mark)
Si guardas tu archivo HTML con "UTF-8 con BOM" en Notepad (Windows), aparecen caracteres invisibles al inicio.
El navegador se confunde y piensa que el archivo ya empezó, cerrando prematuramente el `<head>`.
**Solución:** Siempre guarda como "UTF-8 sin BOM" en VS Code.

### Scripts Bloqueantes
Si pones `<script src="pesado.js">` en el `<head>` sin `defer` ni `async`:
1.  El navegador pausa el parseo del HTML.
2.  Descarga el JS.
3.  Ejecuta el JS.
4.  Retoma el HTML.
**Resultado:** Pantalla blanca por 3 segundos.
**Solución:** SIEMPRE usa `defer`.

---

<div align="center">

[⬅️ Anterior: 2.1 Introducción](2.1.md) &nbsp;&nbsp;|&nbsp;&nbsp; [Siguiente: 2.3 Elementos Básicos](2.3.md) ➡️

</div>
