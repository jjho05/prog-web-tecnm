# 5.5 Plataformas Tecnológicas (¿Dónde pongo mi código?)

El mercado de la nube es un oligopolio con tres gigantes y miles de retadores.

---

## The Big Three (Infraestructura Pesada)

Si eres una empresa Fortune 500, usas una de estas.

### AWS (Amazon Web Services)
*   **Líder del mercado.** El más maduro y completo.
*   **Enfoque:** Bloques de construcción primitivos (te dan el ladrillo, tú construyes la casa).
*   **Ideal para:** Todo. Es el estándar de la industria.

### Microsoft Azure
*   **El favorito corporativo.**
*   **Enfoque:** Integración total con Windows, Office 365 y Active Directory.
*   **Ideal para:** Bancos, Gobierno y empresas que ya usan Microsoft.

### Google Cloud (GCP)
*   **El innovador.**
*   **Enfoque:** Datos e Inteligencia Artificial.
*   **Ideal para:** Big Data, Machine Learning y Kubernetes (lo inventaron ellos).

---

## PaaS para Developers (La Nueva Ola)

Si eres un estudiante o startup, NO empieces con AWS. Usa estos.

## PaaS vs BaaS (Para Developers)

### PaaS (Platform as a Service)
Tú pones el código (Node.js), ellos ponen el servidor.
*   **Vercel:** El rey del Frontend (Next.js/React). Deploy automático desde Git.
*   **Render:** El heredero de Heroku. Genial para Backends y Bases de Datos.
*   **Railway:** Muy visual y fácil para empezar.

### BaaS (Backend as a Service)
Te dan el Backend entero (Base de datos + Auth + Storage). Tú solo haces Frontend.
*   **Firebase:** De Google. Base de datos en tiempo real. Muy fácil pero te atrapa (Lock-in).
*   **Supabase:** Alternativa Open Source basada en SQL (Postgres). Recomendadísimo.

### AWS Lambda @ Edge
*   Permite ejecutar funciones Lambda en los nodos de la CDN (CloudFront).
*   Útil para modificar cabeceras HTTP, redimensionar imágenes al vuelo o autenticación básica.

---

---

## Plataformas de Contenedores (CaaS)

Docker corre en tu laptop. En producción necesitas un **Orquestador**.

### Kubernetes (K8s) - El Rey
*   Estándar de facto.
*   **Complejo:** Tiene una curva de aprendizaje brutal (Pods, Services, Ingress, PVCs).
*   **GKE (Google):** La mejor implementación gestionada (Updates automáticos).
*   **EKS (AWS):** Más manual, pero integrado con IAM de AWS.

### Docker Swarm
*   Viene integrado con Docker.
*   **Ventaja:** Mucho más simple que K8s. Configuración en minutos.
*   **Estado:** En soporte vital. Docker (la empresa) se enfoca en K8s ahora.

### Amazon ECS (Proprietary)
*   La solución nativa de AWS antes de K8s.
*   Muy simple de usar si ya conoces AWS. Se integra perfecto con ALBs.

---

## Nube Híbrida (Hybrid Cloud)

Para bancos y hospitales que no pueden llevar sus datos a la nube pública por ley.

### AWS Outposts
*   Amazon te envía un Rack de servidores físicos (tamaño refrigerador) a tu oficina.
*   Es hardware de AWS, pero vive en tu edificio.
*   Lo gestionas desde la consola web de AWS como si fuera una región más.

### Azure Arc
*   Te permite instalar un agente en TUS servidores Linux/Windows físicos.
*   Desde la nube de Azure, ves tus servidores físicos y les aplicas parches y políticas de seguridad.
*   "Gestiona tu infraestructura on-premise como si fuera nube".

---

---

## Plataformas de CI/CD (La Fábrica de Software)

¿Dónde se "cocina" tu código antes de servirlo?

### GitHub Actions
*   **Integración:** Nativa en tu repo.
*   **Uso:** GRATIS para repos públicos. 2000 minutos/mes para privados.
*   **YAML:** Todo se define en `.github/workflows/deploy.yml`.
*   **Marketplace:** Miles de acciones prefabricadas ("Amazon ECR Login", "Setup Node", "Deploy to Heroku").

### GitLab CI
*   **Pionero:** Inventó el concepto de CI/CD moderno integrado en el repo.
*   **Auto DevOps:** Detecta tu código y crea el pipeline solo.
*   **Self-Hosted:** Puedes instalar GitLab en tu propio servidor (Jenkins killer).

### Jenkins
*   **El Abuelo (2004):** Escrito en Java.
*   **Ventaja:** Plugins para TODO. Extremadamente flexible.
*   **Desventaja:** Tienes que mantener el servidor Jenkins. Se rompe fácil. UI horrible.

---

## Plataformas de Observabilidad (El Dashboard)

Una vez desplegado, ¿cómo sabes si funciona?

### Datadog
*   **El Estándar Enterprise.**
*   Te da métricas (CPU), Logs y Tracing en una sola pantalla.
*   **Precio:** Muy caro ($15/servidor + cobro por GB de logs).

### Prometheus + Grafana (Open Source)
*   **Prometheus:** Base de datos de series de tiempo (Metrics). Scrapea tus pods cada 15s.
*   **Grafana:** Visualizador. Creas dashboards hermosos con gráficas.
*   **Costo:** Gratis (si lo hosteas tú).

### ELK Stack (Elasticsearch, Logstash, Kibana)
*   **Especialidad:** Logs.
*   **Búsqueda:** Búsqueda full-text en Petabytes de logs.
*   **Uso:** Análisis forense de seguridad.

---

---

## Tutorial: De Local a Producción en 5 minutos

### Frontend (React en Vercel)
1.  **Código:** Tienes tu app React en GitHub (`git commit`).
2.  **Cuenta:** Entra a `vercel.com` y loguéate con GitHub.
3.  **New Project:** Clic en "Add New..." -> "Project".
4.  **Import:** Selecciona tu repo `mi-app-react` de la lista.
5.  **Settings:** Vercel detecta automáticamente que es `Create React App`.
    *   *Build Command:* `npm run build`
    *   *Output Directory:* `build`
6.  **Deploy:** Clic en "Deploy".
7.  **Resultado:** En 30 segundos tienes `https://mi-app-react.vercel.app` con SSL gratis.
8.  **CI/CD:** Haz un cambio en tu VS Code, `git push`, y Vercel redesplegará automáticamente.

### Backend (Node/Express en Render)
1.  **Web Service:** En `dashboard.render.com` selecciona "New Web Service".
2.  **Repo:** Conecta tu GitHub.
3.  **Runtime:** Selecciona "Node".
4.  **Commands:**
    *   *Build Command:* `npm install`
    *   *Start Command:* `node app.js`
5.  **Plan:** Selecciona "Free".
6.  **Variables:** Agrega `DB_URL` y secretos aquí.
7.  **Create:** Render clonará tu repo, instalará dependencias e iniciará el servidor.
8.  **URL:** Te dará `https://mi-api.onrender.com`. (Nota: Tardará 50s en despertar si está inactivo en el plan free).

---

---

## Infraestructura como Código (IaC)
No uses el mouse. Define tu infraestructura en archivos de texto.

### Terraform
El estándar de la industria. Funciona con AWS, Azure, Google y más.
```hcl
resource "aws_s3_bucket" "mi_bucket" {
  bucket = "mi-app-fotos-2025"
}
```
Si borras el servidor por error, corres `terraform apply` y se reconstruye solo.

---

## Gestión de Costos (Cómo no quebrar)

La nube cobra por segundo. Si dejas un servidor encendido un mes, pagas el mes.

### La Regla de Oro
**"Si no lo usas, apágalo."**
*   Usa **"Spot Instances"** para ahorrar 90% en pruebas.
*   Configura **AWS Budgets** para recibir un email si gastas más de $1 USD.

### AWS Free Tier (Trucos)
*   **EC2:** 750 horas al mes de `t2.micro` o `t3.micro` (solo el primer año).
*   **Lambda:** 1 millón de peticiones al mes (para siempre).
*   **DynamoDB:** 25 GB de almacenamiento (para siempre).
*   *Cuidado:* Las direcciones IP estáticas (Elastic IPs) cobran si no están en uso.

---

## Certificaciones (Tu Camino Profesional)

Si quieres trabajo en esto, saca estas certificaciones:

1.  **Nivel Fundamentos:** AWS Cloud Practitioner / Azure Fundamentals. (Fácil, 2 semanas de estudio).
2.  **Nivel Asociado:** AWS Solutions Architect Associate. (El estándar de oro. 3 meses de estudio).
3.  **Nivel Profesional:** DevOps Engineer Professional. (Difícil. Requiere experiencia real).

---

---

## PaaS Battle Royale (¿Cuál elijo?)

| Plataforma | Heroku | Render | Railway | Fly.io |
| :--- | :--- | :--- | :--- | :--- |
| **Simplicidad** | ⭐️⭐️⭐️⭐️⭐️ | ⭐️⭐️⭐️⭐️ | ⭐️⭐️⭐️⭐️⭐️ | ⭐️⭐️ |
| **Costo** | Caro ($$$) | Medio ($$) | Medio ($$) | Barato ($) |
| **Free Tier** | No | Sí (Limitado) | No (Crédito inicial) | Sí (Limitado) |
| **Velocidad Deploy** | Medio | Lento | Rápido | Rápido |
| **Región Global** | USA/EU | Global | USA/EU | Global (Edge) |
| **Base de Datos** | Add-on caro | Nativa | Nativa | SQLite/PG |
| **Veredicto** | El standard legacy | El nuevo estándar | Para hobbystas | Para expertos |

---

## Kubernetes Objects Deep Dive (Diccionario K8s)

Vas a ver esto en todas partes. Apréndetelo.

### Pod
*   La unidad atómica.
*   Es un grupo de uno o más contenedores (Docker) que comparten IP.
*   "Piensa en un Pod como una máquina virtual lógica".

### Deployment (ReplicaSet)
*   Es el jefe de los Pods.
*   "Quiero que siempre haya 3 copias de mi Pod `api-server` corriendo".
*   Si un Pod muere, el Deployment crea otro al instante.

### Service (La IP Fija)
*   Los Pods mueren y cambian de IP.
*   El Service es una IP estable que balancea carga a los Pods vivos.
*   Tipos: `ClusterIP` (Interno), `LoadBalancer` (Público).

### Ingress (El Portero)
*   Es una regla de ruteo HTTP.
*   "Si llega tráfico a `api.midominio.com`, mándalo al Service `api-service`".
*   Maneja SSL/HTTPS automáticamente.

---

## Platform Engineering (El futuro de DevOps)

Ya no queremos que el Developer se preocupe por Dockerfiles.
*   **Internal Developer Platform (IDP):** Un portal interno (como Backstage de Spotify).
*   El Dev entra, hace clic en "Crear Microservicio Spring Boot", y la plataforma le da el repo, el CI/CD, la DB y el DNS listos en 5 minutos.
*   **Objetivo:** Reducir la carga cognitiva del desarrollador.

---

---

## La Nube Open Source (Hazlo tú mismo)

Si no quieres pagarle a Amazon, construye tu propia nube.

### OpenStack
*   El sistema operativo de la nube.
*   NASA y Rackspace lo crearon.
*   Convierte 50 servidores Dell viejos en una nube privada tipo AWS.
*   **Dificultad:** Pesadilla. Necesitas un equipo de ingenieros dedicados.

### MinIO (Tu propio S3)
*   Servidor de almacenamiento de objetos compatible con la API de S3.
*   Corre en un docker container.
*   Úsalo en desarrollo para no gastar dinero en AWS S3 real.

### Ceph
*   Almacenamiento distribuido masivo.
*   Es la backend de almacenamiento de la mayoría de las nubes privadas.

---

## Service Mesh & Secrets (Infraestructura Avanzada)

### HashiCorp Vault (Secretos)
*   **Problema:** ¿Dónde guardo la contraseña de la base de datos? ¿En `.env`? (Inseguro).
*   **Solución:** Vault encripta los secretos y **los rota automáticamente** cada hora.
*   Tu aplicación pide una contraseña y Vault le da una temporal que expira en 60 mins.

### Istio vs Linkerd (Service Mesh)
*   **Istio:** El gigante de Google/IBM. Muy poderoso, muy complejo.
*   **Linkerd:** Hecho en Rust. Ultra ligero y rápido. "Service Mesh para humanos".

---

## Glosario CNCF (Cloud Native Computing Foundation)

Términos que escucharás en las entrevistas:

*   **Helm:** El "npm" de Kubernetes. Instala aplicaciones complejas (Prometheus, Postgres) en un comando.
*   **Etcd:** El cerebro de Kubernetes. Ahí se guarda el estado del cluster.
*   **Fluentd:** Recolector de logs universal.
*   **Jaeger:** Rastreo distribuido (Distributed Tracing).
*   **Envoy:** Proxy de alto rendimiento (C++). Es el motor de Istio.
*   **Harbor:** Registro de contenedores privado (Tu propio Docker Hub seguro).

---

---

## Un día en la vida de un DevOps (Narrativa)

¿Qué haces realmente en el trabajo?

*   **09:00 AM:** Daily Standup. El equipo de Backend dice que la DB está lenta.
*   **09:30 AM:** Abres **Datadog**. Ves un pico de CPU en RDS (Base de datos).
*   **10:00 AM:** Descubres una query SQL sin índice (`SELECT * FROM users`).
*   **11:00 AM:** Abres **Terraform**. Creas una Read Replica para quitarle carga a la DB principal.
*   **11:30 AM:** `terraform apply`. AWS empieza a crear el servidor.
*   **12:00 PM:** Almuerzo.
*   **01:00 PM:** La réplica está lista. Cambias la variable de entorno `DB_READ_HOST` en el panel de **Vercel**.
*   **01:10 PM:** Vercel redesplegará el frontend automáticamente.
*   **02:00 PM:** El CPU de la DB baja al 10%. Problema resuelto.
*   **03:00 PM:** Escribes un **Post-Mortem** en Notion explicando qué pasó y cómo evitarlo.

---

## Checklist: ¿Estás listo para Producción?

No salgas a producción si no tienes esto:

1.  [ ] **HTTPS:** SSL forzado en todas partes.
2.  [ ] **Health Checks:** `/health` endpoint respondiendo 200 OK.
3.  [ ] **Logs Centralizados:** ¿Si el servidor explota, dónde veo los logs?
4.  [ ] **Alertas:** ¿Te llega un email si el sitio se cae? (Usa UptimeRobot gratis).
5.  [ ] **Backups:** ¿Tienes backup de la DB? ¿Probaste restaurarlo ayer?
6.  [ ] **Rate Limiting:** ¿Qué pasa si alguien te ataca con 1000 requests/seg?
7.  [ ] **Secretos:** ¿No hay contraseñas en el código fuente?
8.  [ ] **Costo:** ¿Tienes alarmas de facturación configuradas?

---

## Herramientas CLI Esenciales (Tu navaja suiza)

Instala esto en tu Mac/Linux hoy mismo.

*   `jq`: Formatea JSON en la terminal.
    *   `curl api.com | jq .`
*   `curl`: Cliente HTTP.
    *   `curl -X POST -d '{"a":1}' api.com`
*   `nc` (Netcat): Prueba puertos.
    *   `nc -zv google.com 80` (¿Está abierto el puerto?)
*   `htop`: Administrador de tareas visual para Linux.
*   `docker system prune`: Borra toda la basura de Docker para recuperar espacio en disco.

---

---

## Serverless Framework (El Estándar para Lambda)

Gestionar Lambdas con AWS Console es doloroso. Usa **Serverless Framework**.

### `serverless.yml`
Este archivo define toda tu aplicación.

```yaml
service: mi-api-serverless
provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1

functions:
  crearUsuario:
    handler: handler.crearUsuario
    events:
      - http:
          path: users/create
          method: post

resources:
  Resources:
    UsersTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: users-table
        AttributeDefinitions:
          - AttributeName: userId
            AttributeType: S
        KeySchema:
          - AttributeName: userId
            KeyType: HASH
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
```

*   **Deploy:** `sls deploy`. AWS CloudFormation crea la Lambda, el API Gateway, la DynamoDB y conecta todo.
*   **Remove:** `sls remove`. Borra todo.

---

## Golden Path (El Camino Dorado)

En Platform Engineering, el "Golden Path" es la ruta recomendada y soportada para ir a producción.

*   **Golden Path:** "Usa Node.js 18 + GitHub Actions + EKS". -> El equipo de plataforma te ayuda si algo falla.
*   **Off-road:** "Quiero usar Deno + CircleCI + Nomad". -> Estás por tu cuenta. Si se rompe a las 3 AM, tú lo arreglas.

El objetivo de un buen Ingeniero de Plataforma es hacer que el **Golden Path** sea tan fácil y atractivo que nadie quiera salirse de él.

---

---

## El Mito del Vendor Lock-in

"No uses DynamoDB porque solo corre en AWS. Usa Postgres".

*   **Realidad:** Tu mayor riesgo como Startup es **quebrar porque nadie use tu producto**, no que "AWS te suba los precios en 5 años".
*   **Consejo:** Usa las herramientas nativas (DynamoDB, SQS, Lambda). Te permiten moverte rápido hoy.
*   **La falacia de la portabilidad:** Hacer tu app "Agnóstica de la nube" (K8s puro, Postgres, RabbitMQ) te cuesta 3x más trabajo inicial. Si un día tienes éxito y necesitas migrar, tendrás el dinero para reescribirlo.

---

## Estrategia Multi-Cloud (Mala Idea)

"Voy a usar AWS para Cómputo y GCP para BigQuery".

*   **Costo de Egreso:** Mover datos DE AWS hacia GCP te cuesta una fortuna en ancho de banda.
*   **Latencia:** Tus servidores están lejos de tus datos (milisegundos importan).
*   **Complejidad de Seguridad/IAM:** Tienes que gestionar usuarios y permisos en dos nubes distintas.
*   **Excepción:** Solo usa Multi-Cloud si eres un banco obligado por ley o si compraste otra empresa que ya usaba la otra nube.

---

---

## Caso de Estudio: La Gran Migración (Heroku a Kubernetes)

La historia típica de una Startup exitosa.

### Fase 1: El MVP (Día 0 - Año 1)
*   **Plataforma:** Heroku.
*   **Equipo:** 2 Developers.
*   **Costo:** $50/mes.
*   **Ventaja:** Nadie sabe configurar servidores. Solo hacen `git push`. Se enfocan 100% en producto.

### Fase 2: El Crecimiento (Año 2 - Año 3)
*   **Plataforma:** Heroku Enterprise.
*   **Equipo:** 15 Developers.
*   **Problema:** La factura llega de $15,000/mes. Heroku cobra mucho por RAM extra.
*   **Decisión:** "Necesitamos migrar a AWS para ahorrar".

### Fase 3: La Pesadilla de DevOps (Año 3)
*   **Plataforma:** AWS EKS (Kubernetes).
*   **Equipo:** Contratan a 2 Ingenieros DevOps ($150k/año c/u).
*   **Realidad:** Tardan 6 meses en configurar la VPC, el Ingress, los certificados y el CI/CD que Heroku les daba gratis.
*   **Resultado:** La factura de AWS baja a $4,000/mes... pero la nómina subió $300k/año.
*   **Lección:** No subestimes el "Costo Total de Propiedad" (TCO). Kubernetes no es gratis, pagas con tiempo humano.

---

<div align="center">

[⬅️ Anterior: 5.4 Estándares](5.4.md) &nbsp;&nbsp;|&nbsp;&nbsp; [Siguiente: 5.6 Seguridad](5.6.md) ➡️

</div>
